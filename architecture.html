
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>License Manager Architecture &#8212; License Manager Official Documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Development" href="development.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">License Manager Official Documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="development.html">
   Development
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Architecture
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/architecture.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/omnivector-solutions/license-manager"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/omnivector-solutions/license-manager/issues/new?title=Issue%20on%20page%20%2Farchitecture.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license-manager-agent">
   License Manager Agent
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reconciliation">
     Reconciliation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bookings">
     Bookings
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grace-time">
     Grace time
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license-manager-api">
   License Manager API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configurations">
     Configurations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#license-servers">
     License Servers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#products">
     Products
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#features">
     Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jobs">
     Jobs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Bookings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license-manager-cli">
   License Manager CLI
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#global-commands">
     Global commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuration-commands">
     Configuration commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#license-server-commands">
     License server commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#product-commands">
     Product commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-commands">
     Feature commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#job-commands">
     Job commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#booking-commands">
     Booking commands
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>License Manager Architecture</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license-manager-agent">
   License Manager Agent
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reconciliation">
     Reconciliation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bookings">
     Bookings
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grace-time">
     Grace time
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license-manager-api">
   License Manager API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configurations">
     Configurations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#license-servers">
     License Servers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#products">
     Products
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#features">
     Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jobs">
     Jobs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Bookings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license-manager-cli">
   License Manager CLI
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#global-commands">
     Global commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuration-commands">
     Configuration commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#license-server-commands">
     License server commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#product-commands">
     Product commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-commands">
     Feature commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#job-commands">
     Job commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#booking-commands">
     Booking commands
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="license-manager-architecture">
<h1>License Manager Architecture<a class="headerlink" href="#license-manager-architecture" title="Permalink to this headline">¶</a></h1>
<p>The License Manager is based on a client/backend architecture. The backend consists of a RESTful API built with Python over a
PostgreSQL database. The client consists of a timed reconcile job that runs on the control node in the cluster and
a prolog integration to Slurm.</p>
<div class="section" id="license-manager-agent">
<h2>License Manager Agent<a class="headerlink" href="#license-manager-agent" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> is responsible for keeping the local cluster license totals
in sync with the the 3rd party license server totals. It's also responsible for making booking requests
to the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">API</span></code> when Slurm is configured to use the <code class="docutils literal notranslate"><span class="pre">PrologSlurmctld</span></code> script provided by <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code>.</p>
<div class="section" id="reconciliation">
<h3>Reconciliation<a class="headerlink" href="#reconciliation" title="Permalink to this headline">¶</a></h3>
<p>For each license tracked by License Manager, the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> will periodically poll the license servers to get
the usage information and store it in the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">API</span></code>. The <code class="docutils literal notranslate"><span class="pre">stat-interval</span></code> is the period of time
between each reconciliation and can be configured in the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> configuration file.</p>
<p>The information in the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">API</span></code> is used by the reconciliation process to update the license counters in Slurm.
This is done by creating a reservation to represent the licenses used in the license server.</p>
<p>This reservation is not meant to be consumed by users nor jobs; it's only a representation of the licenses in use.
The reservation is created by the user configured in the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> configuration file. The user must
have a user account in the Slurm cluster and have <code class="docutils literal notranslate"><span class="pre">operator</span></code> privilege level to manage reservations.</p>
</div>
<div class="section" id="bookings">
<h3>Bookings<a class="headerlink" href="#bookings" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> is also responsible for making booking requests to the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">API</span></code>
when Slurm is configured to use the <code class="docutils literal notranslate"><span class="pre">PrologSlurmctld</span></code> script provided by <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code>.</p>
<p>Each job submitted to Slurm will trigger the <code class="docutils literal notranslate"><span class="pre">PrologSlurmctld</span></code> script that makes a request to the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">API</span></code>
to book the needed licenses prior to the allocation of the job. The booking ensures that the licenses are available for the job
to use by taking into consideration the licenses booked for other jobs and the license usage in the license server.</p>
<p>If the booking cannot be made, the job will be kept in the queue until there are enough licenses available to
satisfy the booking request.</p>
</div>
<div class="section" id="grace-time">
<h3>Grace time<a class="headerlink" href="#grace-time" title="Permalink to this headline">¶</a></h3>
<p>A job can take some time to check out the license from the license server after it is submitted to Slurm.
Thus, each license has a <code class="docutils literal notranslate"><span class="pre">grace</span> <span class="pre">time</span></code> period that is used to indicate how long a booking will be retained.
After the <code class="docutils literal notranslate"><span class="pre">grace</span> <span class="pre">time</span></code> expires, the booking is deleted. This means that the license was checked out from the
license server and doesn't need a booking anymore.</p>
</div>
</div>
<div class="section" id="license-manager-api">
<h2>License Manager API<a class="headerlink" href="#license-manager-api" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">API</span></code> provides a RESTful API where licenses and bookins are tracked.
The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> uses this API to store the license usage information and to process the booking requests.
The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">CLI</span></code> interacts with this API to add new configurations and to check the usage information for each tracked license.</p>
<p>The API is also responsible for verifying if the booking requests can be satisfied by accounting for bookings already
made and the license usage in the license server.</p>
<p>The API contains 6 entities that have relationship among them.
This means that some of the resources need to be created before others can be created as well.</p>
<div class="mermaid">
            erDiagram
    Bookings {
        int id pk
        int job_id pk
        int feature_id pk
        int quantity
    }
    Features {
        int id pk,fk
        int config_id pk
        int product_id pk
        int reserved
        int total
        int used
        str name
    }
    Products {
        int id pk
        str name
    }
    Jobs {
        int id pk, fk
        str slurm_job_id
        str cluster_client_id
        str username
        str lead_host
    }
    Configurations {
        int id pk
        str name
        str cluster_client_id
        int grace_time
        enum[str] type
    }
    LicenseServers {
        int id pk
        int config_id fk
        str host
        int port
    }
    Jobs ||--o{ Bookings : &quot;&quot;
    Features ||--o{ Bookings : &quot;&quot;
    Products ||--o{ Features : &quot;&quot;
    Configurations ||--|{ Features : &quot;&quot;
    Configurations ||--|{ LicenseServers : &quot;&quot;
        </div><div class="section" id="configurations">
<h3>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Configuration</span></code> resource holds the information for a set of features that are available on the same license server.</p>
<p>A configuration is attached to a cluster and can have <code class="docutils literal notranslate"><span class="pre">n</span></code> features attached to it.
It also defines the license type, the license server host addresses and the grace time period.
The license type identifies the provider of the license server.</p>
<p>The following license server types are supported:</p>
<ul class="simple">
<li><p>FlexLM</p></li>
<li><p>RLM</p></li>
<li><p>LS-Dyna</p></li>
<li><p>LM-X</p></li>
<li><p>OLicense</p></li>
</ul>
<p>Endpoints available:</p>
<ul class="simple">
<li><p>POST <code class="docutils literal notranslate"><span class="pre">/lm/configurations</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/configurations</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/configurations/by_client_id</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/configurations/{id}</span></code></p></li>
<li><p>PUT <code class="docutils literal notranslate"><span class="pre">/lm/configurations/{id}</span></code></p></li>
<li><p>DEL <code class="docutils literal notranslate"><span class="pre">/lm/configurations/{id}</span></code></p></li>
</ul>
<p>The endpoint <code class="docutils literal notranslate"><span class="pre">by_client_id</span></code> extracts the <code class="docutils literal notranslate"><span class="pre">cluster_client_id</span></code> from the request and returns the configurations that belong to the cluster.</p>
<p>Payload example for POST:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;configuration-name&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;cluster_client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cluster-client-id&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;grace_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;flexlm&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>After creating a configuration, the license servers and features can be added.</p>
</div>
<div class="section" id="license-servers">
<h3>License Servers<a class="headerlink" href="#license-servers" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Server</span></code> resource represents the actual license server where the license is installed.</p>
<p>A license server has a host and a port, and needs to be attached to a configuration.
Each configuration can have <code class="docutils literal notranslate"><span class="pre">n</span></code> license servers, as long as they provide the same data (mirrored for redundancy).</p>
<p>Endpoints available:</p>
<ul class="simple">
<li><p>POST <code class="docutils literal notranslate"><span class="pre">/lm/license_servers</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/license_servers</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/license_servers/{id}</span></code></p></li>
<li><p>PUT <code class="docutils literal notranslate"><span class="pre">/lm/license_servers/{id}</span></code></p></li>
<li><p>DEL <code class="docutils literal notranslate"><span class="pre">/lm/license_servers/{id}</span></code></p></li>
</ul>
<p>Payload example for POST:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;config_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;licserv0001&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="products">
<h3>Products<a class="headerlink" href="#products" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Product</span></code> resource represents the product name of the license.</p>
<p>Each license is identified as <code class="docutils literal notranslate"><span class="pre">product.feature&#64;license_server_type</span></code>.
To create a <code class="docutils literal notranslate"><span class="pre">Feature</span></code>, a <code class="docutils literal notranslate"><span class="pre">Product</span></code> needs to be created first.</p>
<p>Endpoints available:</p>
<ul class="simple">
<li><p>POST <code class="docutils literal notranslate"><span class="pre">/lm/products</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/products</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/products/{id}</span></code></p></li>
<li><p>PUT <code class="docutils literal notranslate"><span class="pre">/lm/products/{id}</span></code></p></li>
<li><p>DEL <code class="docutils literal notranslate"><span class="pre">/lm/products/{id}</span></code></p></li>
</ul>
<p>Payload example for POST:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abaqus&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Feature</span></code> resource represents the licenses in the cluster.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">Feature</span></code> is attached to a <code class="docutils literal notranslate"><span class="pre">Configuration</span></code> and a <code class="docutils literal notranslate"><span class="pre">Product</span></code>.</p>
<p>The feature has a <code class="docutils literal notranslate"><span class="pre">reserved</span></code> value, that represents how many licenses should be reserved for usage in desktop applications.
The amount of licenses reserved is not used by the cluster.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> polls the license server to populate the <code class="docutils literal notranslate"><span class="pre">used</span></code> and <code class="docutils literal notranslate"><span class="pre">total</span></code> values.
The information stored includes the total number of licenses available and how many licenses are in use.</p>
<p>Endpoints available:</p>
<ul class="simple">
<li><p>POST <code class="docutils literal notranslate"><span class="pre">/lm/features</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/features</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/features/{id}</span></code></p></li>
<li><p>PUT <code class="docutils literal notranslate"><span class="pre">/lm/features/{id}</span></code></p></li>
<li><p>PUT <code class="docutils literal notranslate"><span class="pre">/lm/features/by_client_id</span></code></p></li>
<li><p>DEL <code class="docutils literal notranslate"><span class="pre">/lm/features/{id}</span></code></p></li>
</ul>
<p>The endpoint <code class="docutils literal notranslate"><span class="pre">by_client_id</span></code> extracts the <code class="docutils literal notranslate"><span class="pre">cluster_client_id</span></code> from the request and updates the feature for that cluster.</p>
<p>This endpoint is needed since there can be multiple licenses with the same name in different clusters.</p>
<p>Payload example for POST:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abaqus&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;product_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;config_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;reserved&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="jobs">
<h3>Jobs<a class="headerlink" href="#jobs" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Job</span></code> resource represents the jobs submitted to the cluster.</p>
<p>When a job is intercepted by the <code class="docutils literal notranslate"><span class="pre">PrologSlurmctld</span></code> script, the job is created automatically.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">Job</span></code> can have <code class="docutils literal notranslate"><span class="pre">n</span></code> <code class="docutils literal notranslate"><span class="pre">Bookings</span></code> attached to it.
If the job requires licenses, a <code class="docutils literal notranslate"><span class="pre">Booking</span></code> is created for each license.
Once the job finishes, the <code class="docutils literal notranslate"><span class="pre">EpilogSlurmctld</span></code> deletes the job from the API, along with its bookings.</p>
<p>Since the <code class="docutils literal notranslate"><span class="pre">slurm_job_id</span></code> is not unique across clusters, each job is identified by the <code class="docutils literal notranslate"><span class="pre">cluster_client_id</span></code> alongside the <code class="docutils literal notranslate"><span class="pre">slurm_job_id</span></code>.</p>
<p>Endpoints available:</p>
<ul class="simple">
<li><p>POST <code class="docutils literal notranslate"><span class="pre">/lm/jobs</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/jobs</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/jobs/by_client_id</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/jobs/{id}</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/jobs/slurm_job_id/{slurm_job_id}</span></code></p></li>
<li><p>DEL <code class="docutils literal notranslate"><span class="pre">/lm/jobs/{id}</span></code></p></li>
<li><p>DEL <code class="docutils literal notranslate"><span class="pre">/lm/jobs/slurm_job_id/{slurm_job_id}</span></code></p></li>
</ul>
<p>The endpoint <code class="docutils literal notranslate"><span class="pre">by_client_id</span></code> extracts the <code class="docutils literal notranslate"><span class="pre">cluster_client_id</span></code> from the request and returns the jobs that belong to the cluster.</p>
<p>The in the POST endpoint, the parameter <code class="docutils literal notranslate"><span class="pre">cluster_client_id</span></code> is optional. If it's not provided, the <code class="docutils literal notranslate"><span class="pre">cluster_client_id</span></code> is extracted from the request.</p>
<p>Payload example for POST:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;slurm_job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;cluster_client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cluster-client-id&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user123&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;lead_host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;host1&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>Bookings<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Booking</span></code> resource is responsible for booking licenses for a specific job.</p>
<p>The booking ensures the job will have enough licenses to be used when the <code class="docutils literal notranslate"><span class="pre">grace</span> <span class="pre">time</span></code> is reached.
<code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> stores the information about the booking requests made by Slurm when the <code class="docutils literal notranslate"><span class="pre">PrologSlurmctld</span></code>
script is used.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">Booking</span></code> is attached to a <code class="docutils literal notranslate"><span class="pre">Job</span></code>. The <code class="docutils literal notranslate"><span class="pre">job_id</span></code> parameter identifies the job in the API, and is different from the <code class="docutils literal notranslate"><span class="pre">slurm_job_id</span></code>
that idenfies it in the cluster.</p>
<p>Endpoints available:</p>
<ul class="simple">
<li><p>POST <code class="docutils literal notranslate"><span class="pre">/lm/bookings</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/bookings</span></code></p></li>
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/lm/bookings/{id}</span></code></p></li>
<li><p>DEL <code class="docutils literal notranslate"><span class="pre">/lm/bookings/{id}</span></code></p></li>
</ul>
<p>Payload example for POST:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;feature_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;quantity&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="license-manager-cli">
<h2>License Manager CLI<a class="headerlink" href="#license-manager-cli" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">CLI</span></code> is a client to interact with the <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Manager</span> <span class="pre">API</span></code>.</p>
<p>It can be used to add new configurations to the API and to check the usage information for each tracked license.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Jobs</span></code> and <code class="docutils literal notranslate"><span class="pre">Bookings</span></code> are read only. The remaining resources can be edited by users with permission to do so.</p>
<div class="section" id="global-commands">
<h3>Global commands<a class="headerlink" href="#global-commands" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Command</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lm-cli login</p></td>
<td><p>Generate a URL for logging in via browser</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli show-token</p></td>
<td><p>Print your access token (created after logging in)</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli logout</p></td>
<td><p>Logout and remove your access token</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-commands">
<h3>Configuration commands<a class="headerlink" href="#configuration-commands" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 62%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Command</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lm-cli configurations list</p></td>
<td><p>List all configurations</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli configurations list</p>
<p>--search &lt;search string&gt;</p>
</td>
<td><p>Search configurations with the specified string</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli configurations list</p>
<p>--sort-field &lt;sort field&gt;</p>
</td>
<td><p>Sort configurations by the specified field</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli configurations list</p>
<p>--sort-field &lt;sort field&gt;</p>
<p>--sort-order ascending</p>
</td>
<td><p>Sort configurations by the specified order</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli configurations get-one</p>
<p>--id &lt;configuration id&gt;</p>
</td>
<td><p>List the configuration with the specified id</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli configurations create</p>
<p>--name &lt;configuration name&gt;</p>
<p>--cluster-client-id &lt;OIDC client_id of the cluster where the configuration applies</p>
<p>--grace-time &lt;grace time in seconds&gt;</p>
<p>--license-server-type &lt;license server type&gt;</p>
</td>
<td><p>Create a new configuration</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli configurations delete</p>
<p>--id &lt;id to delete&gt;</p>
</td>
<td><p>Delete the configuration with the specified id</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="license-server-commands">
<h3>License server commands<a class="headerlink" href="#license-server-commands" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Command</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lm-cli license-servers list</p></td>
<td><p>List all license servers</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli license-servers list</p>
<p>--search &lt;search string&gt;</p>
</td>
<td><p>Search license servers with the specified string</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli license-servers list</p>
<p>--sort-field &lt;sort field&gt;</p>
</td>
<td><p>Sort license servers by the specified field</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli license-servers list</p>
<p>--sort-field &lt;sort field&gt;</p>
<p>--sort-order ascending</p>
</td>
<td><p>Sort license servers by the specified order</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli license-servers get-one</p>
<p>--id &lt;license server id&gt;</p>
</td>
<td><p>List the license server with the specified id</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli license-servers create</p>
<p>--config-id &lt;id of the configuration to add the license server&gt;</p>
<p>--host &lt;hostname of the license server&gt;</p>
<p>--port &lt;port of the license server&gt;</p>
</td>
<td><p>Create a new license server</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli license-servers delete --id &lt;id to delete&gt;</p>
<p>--id &lt;id to delete&gt;</p>
</td>
<td><p>Delete the license server with the specified id</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="product-commands">
<h3>Product commands<a class="headerlink" href="#product-commands" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Command</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lm-cli products list</p></td>
<td><p>List all products</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli products list</p>
<p>--search &lt;search string&gt;</p>
</td>
<td><p>Search products with the specified string</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli products list</p>
<p>--sort-field &lt;sort field&gt;</p>
</td>
<td><p>Sort products by the specified field</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli products list</p>
<p>--sort-field &lt;sort field&gt;</p>
<p>--sort-order ascending</p>
</td>
<td><p>Sort products by the specified order</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli products get-one</p>
<p>--id &lt;product id&gt;</p>
</td>
<td><p>List the product with the specified id</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli products create</p>
<p>--name &lt;product name&gt;</p>
</td>
<td><p>Create a new product</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli products delete</p>
<p>--id &lt;id to delete&gt;</p>
</td>
<td><p>Delete the product with the specified id</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="feature-commands">
<h3>Feature commands<a class="headerlink" href="#feature-commands" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Command</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lm-cli features list</p></td>
<td><p>List all features</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli features list</p>
<p>--search &lt;search string&gt;</p>
</td>
<td><p>Search features with the specified string</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli features list</p>
<p>--sort-field &lt;sort field&gt;</p>
</td>
<td><p>Sort features by the specified field</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli features list</p>
<p>--sort-field &lt;sort field&gt;</p>
<p>--sort-order ascending</p>
</td>
<td><p>Sort features by the specified order</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli features get-one</p>
<p>--id &lt;feature id&gt;</p>
</td>
<td><p>List the feature with the specified id</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli features create</p>
<p>--name &lt;feature name&gt;</p>
<p>--product-id &lt;id of the product of the license&gt;</p>
<p>--config-id &lt;id of the configuration of the license&gt;</p>
<p>--reserved &lt;how many licenses should be reserved for desktop enviroments&gt;</p>
</td>
<td><p>Create a new feature</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli features delete</p>
<p>--id &lt;id to delete&gt;</p>
</td>
<td><p>Delete the feature with the specified id</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="job-commands">
<h3>Job commands<a class="headerlink" href="#job-commands" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Command</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lm-cli jobs list</p></td>
<td><p>List all jobs</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli jobs list</p>
<p>--search &lt;search string&gt;</p>
</td>
<td><p>Search jobs with the specified string</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli jobs list</p>
<p>--sort-field &lt;sort field&gt;</p>
</td>
<td><p>Sort jobs by the specified field</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli jobs list</p>
<p>--sort-field &lt;sort field&gt;</p>
<p>--sort-order ascending</p>
</td>
<td><p>Sort jobs by the specified order</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="booking-commands">
<h3>Booking commands<a class="headerlink" href="#booking-commands" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Command</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lm-cli bookings list</p></td>
<td><p>List all bookings</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli bookings list</p>
<p>--search &lt;search string&gt;</p>
</td>
<td><p>Search bookings with the specified string</p></td>
</tr>
<tr class="row-even"><td><p>lm-cli bookings list</p>
<p>--sort-field &lt;sort field&gt;</p>
</td>
<td><p>Sort bookings by the specified field</p></td>
</tr>
<tr class="row-odd"><td><p>lm-cli bookings list</p>
<p>--sort-field &lt;sort field&gt;</p>
<p>--sort-order ascending</p>
</td>
<td><p>Sort bookings by the specified order</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="development.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Development</p>
        </div>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Omnivector Solutions <br/>
    
        &copy; Copyright 2020 - 2023, Scania CV AB &amp; Omnivector Solutions, LLC.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>