[tox]
envlist = lint, mypy, unit


# required for pyproject.toml
isolated_build = True

[testenv]
basepython = python3.8
extras =
    dev
    lm-create-jwt
    agent
whitelist_externals = poetry

[testenv:mypy]
commands =
    poetry run mypy {posargs} src/licensemanager2/ jawthorizer/ --exclude src/licensemanager2/workload_managers

[testenv:lint]
commands =
    poetry run flake8 {posargs} --ignore=D400,W605,W503 src/licensemanager2/ jawthorizer/

[testenv:unit]
commands =
    poetry install -v --no-root
    poetry run pytest -vvv -s {posargs} --cov licensemanager2 --cov-report=term-missing --cov-report=html

[flake8]
exclude =
    .git,
    __pycache__,
    .tox,
    mod,
max-line-length = 120
max-complexity = 20

[isort]
lines_after_imports = 2
# ignore from..import vs import while sorting a section
force_sort_within_sections = 1
profile = black
